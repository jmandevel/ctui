#ifndef CTUI_H
#define CTUI_H

#ifdef __cplusplus
extern "C" {
#endif

#include <stddef.h>
#include <stdint.h>

#define CTUI_NS_FOR_FPS(S) (uint64_t)(1000000000.0 / (S))

#define UTF32_REPLACEMENT_CHARACTER 0xFFFD

typedef enum CTUI_PaletteIndexAnsi8 {
  CTUIP_ANSI8_BLACK = 0,
  CTUIP_ANSI8_RED = 1,
  CTUIP_ANSI8_GREEN = 2,
  CTUIP_ANSI8_YELLOW = 3,
  CTUIP_ANSI8_BLUE = 4,
  CTUIP_ANSI8_MAGENTA = 5,
  CTUIP_ANSI8_CYAN = 6,
  CTUIP_ANSI8_WHITE = 7
} CTUI_PaletteIndexAnsi8;

typedef enum CTUI_PaletteIndexAnsi16 {
  CTUIP_ANSI16_BLACK = 0,
  CTUIP_ANSI16_RED = 1,
  CTUIP_ANSI16_GREEN = 2,
  CTUIP_ANSI16_YELLOW = 3,
  CTUIP_ANSI16_BLUE = 4,
  CTUIP_ANSI16_MAGENTA = 5,
  CTUIP_ANSI16_CYAN = 6,
  CTUIP_ANSI16_WHITE = 7,
  CTUIP_ANSI16_BRIGHT_BLACK = 8,
  CTUIP_ANSI16_BRIGHT_RED = 9,
  CTUIP_ANSI16_BRIGHT_GREEN = 10,
  CTUIP_ANSI16_BRIGHT_YELLOW = 11,
  CTUIP_ANSI16_BRIGHT_BLUE = 12,
  CTUIP_ANSI16_BRIGHT_MAGENTA = 13,
  CTUIP_ANSI16_BRIGHT_CYAN = 14,
  CTUIP_ANSI16_BRIGHT_WHITE = 15
} CTUI_PaletteIndexAnsi16;

// https://talyian.github.io/ansicolors/
typedef enum CTUI_PaletteIndexAnsi256 {
  CTUIP_ANSI256_BLACK = 0,
  CTUIP_ANSI256_RED = 1,
  CTUIP_ANSI256_GREEN = 2,
  CTUIP_ANSI256_YELLOW = 3,
  CTUIP_ANSI256_BLUE = 4,
  CTUIP_ANSI256_MAGENTA = 5,
  CTUIP_ANSI256_CYAN = 6,
  CTUIP_ANSI256_WHITE = 7,
  CTUIP_ANSI256_BRIGHT_BLACK = 8,
  CTUIP_ANSI256_BRIGHT_RED = 9,
  CTUIP_ANSI256_BRIGHT_GREEN = 10,
  CTUIP_ANSI256_BRIGHT_YELLOW = 11,
  CTUIP_ANSI256_BRIGHT_BLUE = 12,
  CTUIP_ANSI256_BRIGHT_MAGENTA = 13,
  CTUIP_ANSI256_BRIGHT_CYAN = 14,
  CTUIP_ANSI256_BRIGHT_WHITE = 15,

  CTUIP_ANSI256_CUBE000 = 16,
  CTUIP_ANSI256_CUBE001 = 17,
  CTUIP_ANSI256_CUBE002 = 18,
  CTUIP_ANSI256_CUBE003 = 19,
  CTUIP_ANSI256_CUBE004 = 20,
  CTUIP_ANSI256_CUBE005 = 21,
  CTUIP_ANSI256_CUBE010 = 22,
  CTUIP_ANSI256_CUBE011 = 23,
  CTUIP_ANSI256_CUBE012 = 24,
  CTUIP_ANSI256_CUBE013 = 25,
  CTUIP_ANSI256_CUBE014 = 26,
  CTUIP_ANSI256_CUBE015 = 27,
  CTUIP_ANSI256_CUBE020 = 28,
  CTUIP_ANSI256_CUBE021 = 29,
  CTUIP_ANSI256_CUBE022 = 30,
  CTUIP_ANSI256_CUBE023 = 31,
  CTUIP_ANSI256_CUBE024 = 32,
  CTUIP_ANSI256_CUBE025 = 33,
  CTUIP_ANSI256_CUBE030 = 34,
  CTUIP_ANSI256_CUBE031 = 35,
  CTUIP_ANSI256_CUBE032 = 36,
  CTUIP_ANSI256_CUBE033 = 37,
  CTUIP_ANSI256_CUBE034 = 38,
  CTUIP_ANSI256_CUBE035 = 39,
  CTUIP_ANSI256_CUBE040 = 40,
  CTUIP_ANSI256_CUBE041 = 41,
  CTUIP_ANSI256_CUBE042 = 42,
  CTUIP_ANSI256_CUBE043 = 43,
  CTUIP_ANSI256_CUBE044 = 44,
  CTUIP_ANSI256_CUBE045 = 45,
  CTUIP_ANSI256_CUBE050 = 46,
  CTUIP_ANSI256_CUBE051 = 47,
  CTUIP_ANSI256_CUBE052 = 48,
  CTUIP_ANSI256_CUBE053 = 49,
  CTUIP_ANSI256_CUBE054 = 50,
  CTUIP_ANSI256_CUBE055 = 51,
  CTUIP_ANSI256_CUBE100 = 52,
  CTUIP_ANSI256_CUBE101 = 53,
  CTUIP_ANSI256_CUBE102 = 54,
  CTUIP_ANSI256_CUBE103 = 55,
  CTUIP_ANSI256_CUBE104 = 56,
  CTUIP_ANSI256_CUBE105 = 57,
  CTUIP_ANSI256_CUBE110 = 58,
  CTUIP_ANSI256_CUBE111 = 59,
  CTUIP_ANSI256_CUBE112 = 60,
  CTUIP_ANSI256_CUBE113 = 61,
  CTUIP_ANSI256_CUBE114 = 62,
  CTUIP_ANSI256_CUBE115 = 63,
  CTUIP_ANSI256_CUBE120 = 64,
  CTUIP_ANSI256_CUBE121 = 65,
  CTUIP_ANSI256_CUBE122 = 66,
  CTUIP_ANSI256_CUBE123 = 67,
  CTUIP_ANSI256_CUBE124 = 68,
  CTUIP_ANSI256_CUBE125 = 69,
  CTUIP_ANSI256_CUBE130 = 70,
  CTUIP_ANSI256_CUBE131 = 71,
  CTUIP_ANSI256_CUBE132 = 72,
  CTUIP_ANSI256_CUBE133 = 73,
  CTUIP_ANSI256_CUBE134 = 74,
  CTUIP_ANSI256_CUBE135 = 75,
  CTUIP_ANSI256_CUBE140 = 76,
  CTUIP_ANSI256_CUBE141 = 77,
  CTUIP_ANSI256_CUBE142 = 78,
  CTUIP_ANSI256_CUBE143 = 79,
  CTUIP_ANSI256_CUBE144 = 80,
  CTUIP_ANSI256_CUBE145 = 81,
  CTUIP_ANSI256_CUBE150 = 82,
  CTUIP_ANSI256_CUBE151 = 83,
  CTUIP_ANSI256_CUBE152 = 84,
  CTUIP_ANSI256_CUBE153 = 85,
  CTUIP_ANSI256_CUBE154 = 86,
  CTUIP_ANSI256_CUBE155 = 87,
  CTUIP_ANSI256_CUBE200 = 88,
  CTUIP_ANSI256_CUBE201 = 89,
  CTUIP_ANSI256_CUBE202 = 90,
  CTUIP_ANSI256_CUBE203 = 91,
  CTUIP_ANSI256_CUBE204 = 92,
  CTUIP_ANSI256_CUBE205 = 93,
  CTUIP_ANSI256_CUBE210 = 94,
  CTUIP_ANSI256_CUBE211 = 95,
  CTUIP_ANSI256_CUBE212 = 96,
  CTUIP_ANSI256_CUBE213 = 97,
  CTUIP_ANSI256_CUBE214 = 98,
  CTUIP_ANSI256_CUBE215 = 99,
  CTUIP_ANSI256_CUBE220 = 100,
  CTUIP_ANSI256_CUBE221 = 101,
  CTUIP_ANSI256_CUBE222 = 102,
  CTUIP_ANSI256_CUBE223 = 103,
  CTUIP_ANSI256_CUBE224 = 104,
  CTUIP_ANSI256_CUBE225 = 105,
  CTUIP_ANSI256_CUBE230 = 106,
  CTUIP_ANSI256_CUBE231 = 107,
  CTUIP_ANSI256_CUBE232 = 108,
  CTUIP_ANSI256_CUBE233 = 109,
  CTUIP_ANSI256_CUBE234 = 110,
  CTUIP_ANSI256_CUBE235 = 111,
  CTUIP_ANSI256_CUBE240 = 112,
  CTUIP_ANSI256_CUBE241 = 113,
  CTUIP_ANSI256_CUBE242 = 114,
  CTUIP_ANSI256_CUBE243 = 115,
  CTUIP_ANSI256_CUBE244 = 116,
  CTUIP_ANSI256_CUBE245 = 117,
  CTUIP_ANSI256_CUBE250 = 118,
  CTUIP_ANSI256_CUBE251 = 119,
  CTUIP_ANSI256_CUBE252 = 120,
  CTUIP_ANSI256_CUBE253 = 121,
  CTUIP_ANSI256_CUBE254 = 122,
  CTUIP_ANSI256_CUBE255 = 123,
  CTUIP_ANSI256_CUBE300 = 124,
  CTUIP_ANSI256_CUBE301 = 125,
  CTUIP_ANSI256_CUBE302 = 126,
  CTUIP_ANSI256_CUBE303 = 127,
  CTUIP_ANSI256_CUBE304 = 128,
  CTUIP_ANSI256_CUBE305 = 129,
  CTUIP_ANSI256_CUBE310 = 130,
  CTUIP_ANSI256_CUBE311 = 131,
  CTUIP_ANSI256_CUBE312 = 132,
  CTUIP_ANSI256_CUBE313 = 133,
  CTUIP_ANSI256_CUBE314 = 134,
  CTUIP_ANSI256_CUBE315 = 135,
  CTUIP_ANSI256_CUBE320 = 136,
  CTUIP_ANSI256_CUBE321 = 137,
  CTUIP_ANSI256_CUBE322 = 138,
  CTUIP_ANSI256_CUBE323 = 139,
  CTUIP_ANSI256_CUBE324 = 140,
  CTUIP_ANSI256_CUBE325 = 141,
  CTUIP_ANSI256_CUBE330 = 142,
  CTUIP_ANSI256_CUBE331 = 143,
  CTUIP_ANSI256_CUBE332 = 144,
  CTUIP_ANSI256_CUBE333 = 145,
  CTUIP_ANSI256_CUBE334 = 146,
  CTUIP_ANSI256_CUBE335 = 147,
  CTUIP_ANSI256_CUBE340 = 148,
  CTUIP_ANSI256_CUBE341 = 149,
  CTUIP_ANSI256_CUBE342 = 150,
  CTUIP_ANSI256_CUBE343 = 151,
  CTUIP_ANSI256_CUBE344 = 152,
  CTUIP_ANSI256_CUBE345 = 153,
  CTUIP_ANSI256_CUBE350 = 154,
  CTUIP_ANSI256_CUBE351 = 155,
  CTUIP_ANSI256_CUBE352 = 156,
  CTUIP_ANSI256_CUBE353 = 157,
  CTUIP_ANSI256_CUBE354 = 158,
  CTUIP_ANSI256_CUBE355 = 159,
  CTUIP_ANSI256_CUBE400 = 160,
  CTUIP_ANSI256_CUBE401 = 161,
  CTUIP_ANSI256_CUBE402 = 162,
  CTUIP_ANSI256_CUBE403 = 163,
  CTUIP_ANSI256_CUBE404 = 164,
  CTUIP_ANSI256_CUBE405 = 165,
  CTUIP_ANSI256_CUBE410 = 166,
  CTUIP_ANSI256_CUBE411 = 167,
  CTUIP_ANSI256_CUBE412 = 168,
  CTUIP_ANSI256_CUBE413 = 169,
  CTUIP_ANSI256_CUBE414 = 170,
  CTUIP_ANSI256_CUBE415 = 171,
  CTUIP_ANSI256_CUBE420 = 172,
  CTUIP_ANSI256_CUBE421 = 173,
  CTUIP_ANSI256_CUBE422 = 174,
  CTUIP_ANSI256_CUBE423 = 175,
  CTUIP_ANSI256_CUBE424 = 176,
  CTUIP_ANSI256_CUBE425 = 177,
  CTUIP_ANSI256_CUBE430 = 178,
  CTUIP_ANSI256_CUBE431 = 179,
  CTUIP_ANSI256_CUBE432 = 180,
  CTUIP_ANSI256_CUBE433 = 181,
  CTUIP_ANSI256_CUBE434 = 182,
  CTUIP_ANSI256_CUBE435 = 183,
  CTUIP_ANSI256_CUBE440 = 184,
  CTUIP_ANSI256_CUBE441 = 185,
  CTUIP_ANSI256_CUBE442 = 186,
  CTUIP_ANSI256_CUBE443 = 187,
  CTUIP_ANSI256_CUBE444 = 188,
  CTUIP_ANSI256_CUBE445 = 189,
  CTUIP_ANSI256_CUBE450 = 190,
  CTUIP_ANSI256_CUBE451 = 191,
  CTUIP_ANSI256_CUBE452 = 192,
  CTUIP_ANSI256_CUBE453 = 193,
  CTUIP_ANSI256_CUBE454 = 194,
  CTUIP_ANSI256_CUBE455 = 195,
  CTUIP_ANSI256_CUBE500 = 196,
  CTUIP_ANSI256_CUBE501 = 197,
  CTUIP_ANSI256_CUBE502 = 198,
  CTUIP_ANSI256_CUBE503 = 199,
  CTUIP_ANSI256_CUBE504 = 200,
  CTUIP_ANSI256_CUBE505 = 201,
  CTUIP_ANSI256_CUBE510 = 202,
  CTUIP_ANSI256_CUBE511 = 203,
  CTUIP_ANSI256_CUBE512 = 204,
  CTUIP_ANSI256_CUBE513 = 205,
  CTUIP_ANSI256_CUBE514 = 206,
  CTUIP_ANSI256_CUBE515 = 207,
  CTUIP_ANSI256_CUBE520 = 208,
  CTUIP_ANSI256_CUBE521 = 209,
  CTUIP_ANSI256_CUBE522 = 210,
  CTUIP_ANSI256_CUBE523 = 211,
  CTUIP_ANSI256_CUBE524 = 212,
  CTUIP_ANSI256_CUBE525 = 213,
  CTUIP_ANSI256_CUBE530 = 214,
  CTUIP_ANSI256_CUBE531 = 215,
  CTUIP_ANSI256_CUBE532 = 216,
  CTUIP_ANSI256_CUBE533 = 217,
  CTUIP_ANSI256_CUBE534 = 218,
  CTUIP_ANSI256_CUBE535 = 219,
  CTUIP_ANSI256_CUBE540 = 220,
  CTUIP_ANSI256_CUBE541 = 221,
  CTUIP_ANSI256_CUBE542 = 222,
  CTUIP_ANSI256_CUBE543 = 223,
  CTUIP_ANSI256_CUBE544 = 224,
  CTUIP_ANSI256_CUBE545 = 225,
  CTUIP_ANSI256_CUBE550 = 226,
  CTUIP_ANSI256_CUBE551 = 227,
  CTUIP_ANSI256_CUBE552 = 228,
  CTUIP_ANSI256_CUBE553 = 229,
  CTUIP_ANSI256_CUBE554 = 230,
  CTUIP_ANSI256_CUBE555 = 231,

  CTUIP_ANSI256_GRAY0 = 232,
  CTUIP_ANSI256_GRAY1 = 233,
  CTUIP_ANSI256_GRAY2 = 234,
  CTUIP_ANSI256_GRAY3 = 235,
  CTUIP_ANSI256_GRAY4 = 236,
  CTUIP_ANSI256_GRAY5 = 237,
  CTUIP_ANSI256_GRAY6 = 238,
  CTUIP_ANSI256_GRAY7 = 239,
  CTUIP_ANSI256_GRAY8 = 240,
  CTUIP_ANSI256_GRAY9 = 241,
  CTUIP_ANSI256_GRAY10 = 242,
  CTUIP_ANSI256_GRAY11 = 243,
  CTUIP_ANSI256_GRAY12 = 244,
  CTUIP_ANSI256_GRAY13 = 245,
  CTUIP_ANSI256_GRAY14 = 246,
  CTUIP_ANSI256_GRAY15 = 247,
  CTUIP_ANSI256_GRAY16 = 248,
  CTUIP_ANSI256_GRAY17 = 249,
  CTUIP_ANSI256_GRAY18 = 250,
  CTUIP_ANSI256_GRAY19 = 251,
  CTUIP_ANSI256_GRAY20 = 252,
  CTUIP_ANSI256_GRAY21 = 253,
  CTUIP_ANSI256_GRAY22 = 254,
  CTUIP_ANSI256_GRAY23 = 255
} CTUI_PaletteIndexAnsi256;

#define CTUIP_ANSI256_CUBE(R, G, B)                                            \
  (CTUI_PaletteIndexAnsi256)(16 + (36 * (R)) + (6 * (G)) + (B))

#define CTUIP_ANSI256_GRAY(V) (CTUI_PaletteIndexAnsi256)(232 + (V))

typedef struct CTUI_ColorRgb32 {
  uint8_t r;
  uint8_t g;
  uint8_t b;
  uint8_t a;
} CTUI_ColorRgba32;

typedef enum CTUI_ColorMode {
  CTUIC_ANSI8,
  CTUIC_ANSI16,
  CTUIC_ANSI256,
  CTUIC_RGBA32
} CTUI_ColorMode;

typedef struct CTUI_Color {
  CTUI_ColorMode mode;
  union {
    CTUI_PaletteIndexAnsi8 ansi8;
    CTUI_PaletteIndexAnsi16 ansi16;
    CTUI_PaletteIndexAnsi256 ansi256;
    CTUI_ColorRgba32 rgba32;
  } data;
} CTUI_Color;

#define CTUI_NORMAL255(F)                                                      \
  (uint8_t)((F) <= 0.0f ? 0u                                                   \
                        : ((float)(F) >= 1.0f                                  \
                               ? 255u                                          \
                               : (uint8_t)((float)(F) * 255.0f + 0.5f)))

#define CTUI_RGBA32(R, G, B, A)                                                \
  (CTUI_Color) {                                                               \
    .mode = CTUIC_RGBA32, .data.rgba32 = (CTUI_ColorRgba32) {                  \
      .r = (R), .g = (G), .b = (B), .a = (A)                                   \
    }                                                                          \
  }

#define CTUI_RGBA32N(R, G, B, A)                                               \
  CTUI_RGBA32(CTUI_NORMAL255(R), CTUI_NORMAL255(G), CTUI_NORMAL255(B),         \
              CTUI_NORMAL255(A))

#define CTUI_RGBA32_FROM_COLOR(V)                                              \
  (CTUI_Color) { .mode = CTUIC_RGBA32, .data.rgba32 = (V) }                    \
  }

#define CTUI_ANSI8(V)                                                          \
  (CTUI_Color) { .mode = CTUIC_ANSI8, .data.ansi8 = (V) }

#define CTUI_ANSI16(V)                                                         \
  (CTUI_Color) { .mode = CTUIC_ANSI16, .data.ansi16 = (V) }

#define CTUI_ANSI256(V)                                                        \
  (CTUI_Color) { .mode = CTUIC_ANSI256, .data.ansi256 = (V) }

#define CTUI_BLACK CTUI_ANSI8(CTUIP_ANSI8_BLACK)
#define CTUI_RED CTUI_ANSI8(CTUIP_ANSI8_RED)
#define CTUI_GREEN CTUI_ANSI8(CTUIP_ANSI8_GREEN)
#define CTUI_YELLOW CTUI_ANSI8(CTUIP_ANSI8_YELLOW)
#define CTUI_BLUE CTUI_ANSI8(CTUIP_ANSI8_BLUE)
#define CTUI_MAGENTA CTUI_ANSI8(CTUIP_ANSI8_MAGENTA)
#define CTUI_CYAN CTUI_ANSI8(CTUIP_ANSI8_CYAN)
#define CTUI_WHITE CTUI_ANSI8(CTUIP_ANSI8_WHITE)
#define CTUI_BRIGHT_BLACK CTUI_ANSI16(CTUIP_ANSI16_BRIGHT_BLACK)
#define CTUI_BRIGHT_RED CTUI_ANSI16(CTUIP_ANSI16_BRIGHT_RED)
#define CTUI_BRIGHT_GREEN CTUI_ANSI16(CTUIP_ANSI16_BRIGHT_GREEN)
#define CTUI_BRIGHT_YELLOW CTUI_ANSI16(CTUIP_ANSI16_BRIGHT_YELLOW)
#define CTUI_BRIGHT_BLUE CTUI_ANSI16(CTUIP_ANSI16_BRIGHT_BLUE)
#define CTUI_BRIGHT_MAGENTA CTUI_ANSI16(CTUIP_ANSI16_BRIGHT_MAGENTA)
#define CTUI_BRIGHT_CYAN CTUI_ANSI16(CTUIP_ANSI16_BRIGHT_CYAN)
#define CTUI_BRIGHT_WHITE CTUI_ANSI16(CTUIP_ANSI16_BRIGHT_WHITE)
#define CTUI_CUBE000 CTUI_ANSI256(CTUIP_ANSI256_CUBE000)
#define CTUI_CUBE001 CTUI_ANSI256(CTUIP_ANSI256_CUBE001)
#define CTUI_CUBE002 CTUI_ANSI256(CTUIP_ANSI256_CUBE002)
#define CTUI_CUBE003 CTUI_ANSI256(CTUIP_ANSI256_CUBE003)
#define CTUI_CUBE004 CTUI_ANSI256(CTUIP_ANSI256_CUBE004)
#define CTUI_CUBE005 CTUI_ANSI256(CTUIP_ANSI256_CUBE005)
#define CTUI_CUBE010 CTUI_ANSI256(CTUIP_ANSI256_CUBE010)
#define CTUI_CUBE011 CTUI_ANSI256(CTUIP_ANSI256_CUBE011)
#define CTUI_CUBE012 CTUI_ANSI256(CTUIP_ANSI256_CUBE012)
#define CTUI_CUBE013 CTUI_ANSI256(CTUIP_ANSI256_CUBE013)
#define CTUI_CUBE014 CTUI_ANSI256(CTUIP_ANSI256_CUBE014)
#define CTUI_CUBE015 CTUI_ANSI256(CTUIP_ANSI256_CUBE015)
#define CTUI_CUBE020 CTUI_ANSI256(CTUIP_ANSI256_CUBE020)
#define CTUI_CUBE021 CTUI_ANSI256(CTUIP_ANSI256_CUBE021)
#define CTUI_CUBE022 CTUI_ANSI256(CTUIP_ANSI256_CUBE022)
#define CTUI_CUBE023 CTUI_ANSI256(CTUIP_ANSI256_CUBE023)
#define CTUI_CUBE024 CTUI_ANSI256(CTUIP_ANSI256_CUBE024)
#define CTUI_CUBE025 CTUI_ANSI256(CTUIP_ANSI256_CUBE025)
#define CTUI_CUBE030 CTUI_ANSI256(CTUIP_ANSI256_CUBE030)
#define CTUI_CUBE031 CTUI_ANSI256(CTUIP_ANSI256_CUBE031)
#define CTUI_CUBE032 CTUI_ANSI256(CTUIP_ANSI256_CUBE032)
#define CTUI_CUBE033 CTUI_ANSI256(CTUIP_ANSI256_CUBE033)
#define CTUI_CUBE034 CTUI_ANSI256(CTUIP_ANSI256_CUBE034)
#define CTUI_CUBE035 CTUI_ANSI256(CTUIP_ANSI256_CUBE035)
#define CTUI_CUBE040 CTUI_ANSI256(CTUIP_ANSI256_CUBE040)
#define CTUI_CUBE041 CTUI_ANSI256(CTUIP_ANSI256_CUBE041)
#define CTUI_CUBE042 CTUI_ANSI256(CTUIP_ANSI256_CUBE042)
#define CTUI_CUBE043 CTUI_ANSI256(CTUIP_ANSI256_CUBE043)
#define CTUI_CUBE044 CTUI_ANSI256(CTUIP_ANSI256_CUBE044)
#define CTUI_CUBE045 CTUI_ANSI256(CTUIP_ANSI256_CUBE045)
#define CTUI_CUBE050 CTUI_ANSI256(CTUIP_ANSI256_CUBE050)
#define CTUI_CUBE051 CTUI_ANSI256(CTUIP_ANSI256_CUBE051)
#define CTUI_CUBE052 CTUI_ANSI256(CTUIP_ANSI256_CUBE052)
#define CTUI_CUBE053 CTUI_ANSI256(CTUIP_ANSI256_CUBE053)
#define CTUI_CUBE054 CTUI_ANSI256(CTUIP_ANSI256_CUBE054)
#define CTUI_CUBE055 CTUI_ANSI256(CTUIP_ANSI256_CUBE055)
#define CTUI_CUBE100 CTUI_ANSI256(CTUIP_ANSI256_CUBE100)
#define CTUI_CUBE101 CTUI_ANSI256(CTUIP_ANSI256_CUBE101)
#define CTUI_CUBE102 CTUI_ANSI256(CTUIP_ANSI256_CUBE102)
#define CTUI_CUBE103 CTUI_ANSI256(CTUIP_ANSI256_CUBE103)
#define CTUI_CUBE104 CTUI_ANSI256(CTUIP_ANSI256_CUBE104)
#define CTUI_CUBE105 CTUI_ANSI256(CTUIP_ANSI256_CUBE105)
#define CTUI_CUBE110 CTUI_ANSI256(CTUIP_ANSI256_CUBE110)
#define CTUI_CUBE111 CTUI_ANSI256(CTUIP_ANSI256_CUBE111)
#define CTUI_CUBE112 CTUI_ANSI256(CTUIP_ANSI256_CUBE112)
#define CTUI_CUBE113 CTUI_ANSI256(CTUIP_ANSI256_CUBE113)
#define CTUI_CUBE114 CTUI_ANSI256(CTUIP_ANSI256_CUBE114)
#define CTUI_CUBE115 CTUI_ANSI256(CTUIP_ANSI256_CUBE115)
#define CTUI_CUBE120 CTUI_ANSI256(CTUIP_ANSI256_CUBE120)
#define CTUI_CUBE121 CTUI_ANSI256(CTUIP_ANSI256_CUBE121)
#define CTUI_CUBE122 CTUI_ANSI256(CTUIP_ANSI256_CUBE122)
#define CTUI_CUBE123 CTUI_ANSI256(CTUIP_ANSI256_CUBE123)
#define CTUI_CUBE124 CTUI_ANSI256(CTUIP_ANSI256_CUBE124)
#define CTUI_CUBE125 CTUI_ANSI256(CTUIP_ANSI256_CUBE125)
#define CTUI_CUBE130 CTUI_ANSI256(CTUIP_ANSI256_CUBE130)
#define CTUI_CUBE131 CTUI_ANSI256(CTUIP_ANSI256_CUBE131)
#define CTUI_CUBE132 CTUI_ANSI256(CTUIP_ANSI256_CUBE132)
#define CTUI_CUBE133 CTUI_ANSI256(CTUIP_ANSI256_CUBE133)
#define CTUI_CUBE134 CTUI_ANSI256(CTUIP_ANSI256_CUBE134)
#define CTUI_CUBE135 CTUI_ANSI256(CTUIP_ANSI256_CUBE135)
#define CTUI_CUBE140 CTUI_ANSI256(CTUIP_ANSI256_CUBE140)
#define CTUI_CUBE141 CTUI_ANSI256(CTUIP_ANSI256_CUBE141)
#define CTUI_CUBE142 CTUI_ANSI256(CTUIP_ANSI256_CUBE142)
#define CTUI_CUBE143 CTUI_ANSI256(CTUIP_ANSI256_CUBE143)
#define CTUI_CUBE144 CTUI_ANSI256(CTUIP_ANSI256_CUBE144)
#define CTUI_CUBE145 CTUI_ANSI256(CTUIP_ANSI256_CUBE145)
#define CTUI_CUBE150 CTUI_ANSI256(CTUIP_ANSI256_CUBE150)
#define CTUI_CUBE151 CTUI_ANSI256(CTUIP_ANSI256_CUBE151)
#define CTUI_CUBE152 CTUI_ANSI256(CTUIP_ANSI256_CUBE152)
#define CTUI_CUBE153 CTUI_ANSI256(CTUIP_ANSI256_CUBE153)
#define CTUI_CUBE154 CTUI_ANSI256(CTUIP_ANSI256_CUBE154)
#define CTUI_CUBE155 CTUI_ANSI256(CTUIP_ANSI256_CUBE155)
#define CTUI_CUBE200 CTUI_ANSI256(CTUIP_ANSI256_CUBE200)
#define CTUI_CUBE201 CTUI_ANSI256(CTUIP_ANSI256_CUBE201)
#define CTUI_CUBE202 CTUI_ANSI256(CTUIP_ANSI256_CUBE202)
#define CTUI_CUBE203 CTUI_ANSI256(CTUIP_ANSI256_CUBE203)
#define CTUI_CUBE204 CTUI_ANSI256(CTUIP_ANSI256_CUBE204)
#define CTUI_CUBE205 CTUI_ANSI256(CTUIP_ANSI256_CUBE205)
#define CTUI_CUBE210 CTUI_ANSI256(CTUIP_ANSI256_CUBE210)
#define CTUI_CUBE211 CTUI_ANSI256(CTUIP_ANSI256_CUBE211)
#define CTUI_CUBE212 CTUI_ANSI256(CTUIP_ANSI256_CUBE212)
#define CTUI_CUBE213 CTUI_ANSI256(CTUIP_ANSI256_CUBE213)
#define CTUI_CUBE214 CTUI_ANSI256(CTUIP_ANSI256_CUBE214)
#define CTUI_CUBE215 CTUI_ANSI256(CTUIP_ANSI256_CUBE215)
#define CTUI_CUBE220 CTUI_ANSI256(CTUIP_ANSI256_CUBE220)
#define CTUI_CUBE221 CTUI_ANSI256(CTUIP_ANSI256_CUBE221)
#define CTUI_CUBE222 CTUI_ANSI256(CTUIP_ANSI256_CUBE222)
#define CTUI_CUBE223 CTUI_ANSI256(CTUIP_ANSI256_CUBE223)
#define CTUI_CUBE224 CTUI_ANSI256(CTUIP_ANSI256_CUBE224)
#define CTUI_CUBE225 CTUI_ANSI256(CTUIP_ANSI256_CUBE225)
#define CTUI_CUBE230 CTUI_ANSI256(CTUIP_ANSI256_CUBE230)
#define CTUI_CUBE231 CTUI_ANSI256(CTUIP_ANSI256_CUBE231)
#define CTUI_CUBE232 CTUI_ANSI256(CTUIP_ANSI256_CUBE232)
#define CTUI_CUBE233 CTUI_ANSI256(CTUIP_ANSI256_CUBE233)
#define CTUI_CUBE234 CTUI_ANSI256(CTUIP_ANSI256_CUBE234)
#define CTUI_CUBE235 CTUI_ANSI256(CTUIP_ANSI256_CUBE235)
#define CTUI_CUBE240 CTUI_ANSI256(CTUIP_ANSI256_CUBE240)
#define CTUI_CUBE241 CTUI_ANSI256(CTUIP_ANSI256_CUBE241)
#define CTUI_CUBE242 CTUI_ANSI256(CTUIP_ANSI256_CUBE242)
#define CTUI_CUBE243 CTUI_ANSI256(CTUIP_ANSI256_CUBE243)
#define CTUI_CUBE244 CTUI_ANSI256(CTUIP_ANSI256_CUBE244)
#define CTUI_CUBE245 CTUI_ANSI256(CTUIP_ANSI256_CUBE245)
#define CTUI_CUBE250 CTUI_ANSI256(CTUIP_ANSI256_CUBE250)
#define CTUI_CUBE251 CTUI_ANSI256(CTUIP_ANSI256_CUBE251)
#define CTUI_CUBE252 CTUI_ANSI256(CTUIP_ANSI256_CUBE252)
#define CTUI_CUBE253 CTUI_ANSI256(CTUIP_ANSI256_CUBE253)
#define CTUI_CUBE254 CTUI_ANSI256(CTUIP_ANSI256_CUBE254)
#define CTUI_CUBE255 CTUI_ANSI256(CTUIP_ANSI256_CUBE255)
#define CTUI_CUBE300 CTUI_ANSI256(CTUIP_ANSI256_CUBE300)
#define CTUI_CUBE301 CTUI_ANSI256(CTUIP_ANSI256_CUBE301)
#define CTUI_CUBE302 CTUI_ANSI256(CTUIP_ANSI256_CUBE302)
#define CTUI_CUBE303 CTUI_ANSI256(CTUIP_ANSI256_CUBE303)
#define CTUI_CUBE304 CTUI_ANSI256(CTUIP_ANSI256_CUBE304)
#define CTUI_CUBE305 CTUI_ANSI256(CTUIP_ANSI256_CUBE305)
#define CTUI_CUBE310 CTUI_ANSI256(CTUIP_ANSI256_CUBE310)
#define CTUI_CUBE311 CTUI_ANSI256(CTUIP_ANSI256_CUBE311)
#define CTUI_CUBE312 CTUI_ANSI256(CTUIP_ANSI256_CUBE312)
#define CTUI_CUBE313 CTUI_ANSI256(CTUIP_ANSI256_CUBE313)
#define CTUI_CUBE314 CTUI_ANSI256(CTUIP_ANSI256_CUBE314)
#define CTUI_CUBE315 CTUI_ANSI256(CTUIP_ANSI256_CUBE315)
#define CTUI_CUBE320 CTUI_ANSI256(CTUIP_ANSI256_CUBE320)
#define CTUI_CUBE321 CTUI_ANSI256(CTUIP_ANSI256_CUBE321)
#define CTUI_CUBE322 CTUI_ANSI256(CTUIP_ANSI256_CUBE322)
#define CTUI_CUBE323 CTUI_ANSI256(CTUIP_ANSI256_CUBE323)
#define CTUI_CUBE324 CTUI_ANSI256(CTUIP_ANSI256_CUBE324)
#define CTUI_CUBE325 CTUI_ANSI256(CTUIP_ANSI256_CUBE325)
#define CTUI_CUBE330 CTUI_ANSI256(CTUIP_ANSI256_CUBE330)
#define CTUI_CUBE331 CTUI_ANSI256(CTUIP_ANSI256_CUBE331)
#define CTUI_CUBE332 CTUI_ANSI256(CTUIP_ANSI256_CUBE332)
#define CTUI_CUBE333 CTUI_ANSI256(CTUIP_ANSI256_CUBE333)
#define CTUI_CUBE334 CTUI_ANSI256(CTUIP_ANSI256_CUBE334)
#define CTUI_CUBE335 CTUI_ANSI256(CTUIP_ANSI256_CUBE335)
#define CTUI_CUBE340 CTUI_ANSI256(CTUIP_ANSI256_CUBE340)
#define CTUI_CUBE341 CTUI_ANSI256(CTUIP_ANSI256_CUBE341)
#define CTUI_CUBE342 CTUI_ANSI256(CTUIP_ANSI256_CUBE342)
#define CTUI_CUBE343 CTUI_ANSI256(CTUIP_ANSI256_CUBE343)
#define CTUI_CUBE344 CTUI_ANSI256(CTUIP_ANSI256_CUBE344)
#define CTUI_CUBE345 CTUI_ANSI256(CTUIP_ANSI256_CUBE345)
#define CTUI_CUBE350 CTUI_ANSI256(CTUIP_ANSI256_CUBE350)
#define CTUI_CUBE351 CTUI_ANSI256(CTUIP_ANSI256_CUBE351)
#define CTUI_CUBE352 CTUI_ANSI256(CTUIP_ANSI256_CUBE352)
#define CTUI_CUBE353 CTUI_ANSI256(CTUIP_ANSI256_CUBE353)
#define CTUI_CUBE354 CTUI_ANSI256(CTUIP_ANSI256_CUBE354)
#define CTUI_CUBE355 CTUI_ANSI256(CTUIP_ANSI256_CUBE355)
#define CTUI_CUBE400 CTUI_ANSI256(CTUIP_ANSI256_CUBE400)
#define CTUI_CUBE401 CTUI_ANSI256(CTUIP_ANSI256_CUBE401)
#define CTUI_CUBE402 CTUI_ANSI256(CTUIP_ANSI256_CUBE402)
#define CTUI_CUBE403 CTUI_ANSI256(CTUIP_ANSI256_CUBE403)
#define CTUI_CUBE404 CTUI_ANSI256(CTUIP_ANSI256_CUBE404)
#define CTUI_CUBE405 CTUI_ANSI256(CTUIP_ANSI256_CUBE405)
#define CTUI_CUBE410 CTUI_ANSI256(CTUIP_ANSI256_CUBE410)
#define CTUI_CUBE411 CTUI_ANSI256(CTUIP_ANSI256_CUBE411)
#define CTUI_CUBE412 CTUI_ANSI256(CTUIP_ANSI256_CUBE412)
#define CTUI_CUBE413 CTUI_ANSI256(CTUIP_ANSI256_CUBE413)
#define CTUI_CUBE414 CTUI_ANSI256(CTUIP_ANSI256_CUBE414)
#define CTUI_CUBE415 CTUI_ANSI256(CTUIP_ANSI256_CUBE415)
#define CTUI_CUBE420 CTUI_ANSI256(CTUIP_ANSI256_CUBE420)
#define CTUI_CUBE421 CTUI_ANSI256(CTUIP_ANSI256_CUBE421)
#define CTUI_CUBE422 CTUI_ANSI256(CTUIP_ANSI256_CUBE422)
#define CTUI_CUBE423 CTUI_ANSI256(CTUIP_ANSI256_CUBE423)
#define CTUI_CUBE424 CTUI_ANSI256(CTUIP_ANSI256_CUBE424)
#define CTUI_CUBE425 CTUI_ANSI256(CTUIP_ANSI256_CUBE425)
#define CTUI_CUBE430 CTUI_ANSI256(CTUIP_ANSI256_CUBE430)
#define CTUI_CUBE431 CTUI_ANSI256(CTUIP_ANSI256_CUBE431)
#define CTUI_CUBE432 CTUI_ANSI256(CTUIP_ANSI256_CUBE432)
#define CTUI_CUBE433 CTUI_ANSI256(CTUIP_ANSI256_CUBE433)
#define CTUI_CUBE434 CTUI_ANSI256(CTUIP_ANSI256_CUBE434)
#define CTUI_CUBE435 CTUI_ANSI256(CTUIP_ANSI256_CUBE435)
#define CTUI_CUBE440 CTUI_ANSI256(CTUIP_ANSI256_CUBE440)
#define CTUI_CUBE441 CTUI_ANSI256(CTUIP_ANSI256_CUBE441)
#define CTUI_CUBE442 CTUI_ANSI256(CTUIP_ANSI256_CUBE442)
#define CTUI_CUBE443 CTUI_ANSI256(CTUIP_ANSI256_CUBE443)
#define CTUI_CUBE444 CTUI_ANSI256(CTUIP_ANSI256_CUBE444)
#define CTUI_CUBE445 CTUI_ANSI256(CTUIP_ANSI256_CUBE445)
#define CTUI_CUBE450 CTUI_ANSI256(CTUIP_ANSI256_CUBE450)
#define CTUI_CUBE451 CTUI_ANSI256(CTUIP_ANSI256_CUBE451)
#define CTUI_CUBE452 CTUI_ANSI256(CTUIP_ANSI256_CUBE452)
#define CTUI_CUBE453 CTUI_ANSI256(CTUIP_ANSI256_CUBE453)
#define CTUI_CUBE454 CTUI_ANSI256(CTUIP_ANSI256_CUBE454)
#define CTUI_CUBE455 CTUI_ANSI256(CTUIP_ANSI256_CUBE455)
#define CTUI_CUBE500 CTUI_ANSI256(CTUIP_ANSI256_CUBE500)
#define CTUI_CUBE501 CTUI_ANSI256(CTUIP_ANSI256_CUBE501)
#define CTUI_CUBE502 CTUI_ANSI256(CTUIP_ANSI256_CUBE502)
#define CTUI_CUBE503 CTUI_ANSI256(CTUIP_ANSI256_CUBE503)
#define CTUI_CUBE504 CTUI_ANSI256(CTUIP_ANSI256_CUBE504)
#define CTUI_CUBE505 CTUI_ANSI256(CTUIP_ANSI256_CUBE505)
#define CTUI_CUBE510 CTUI_ANSI256(CTUIP_ANSI256_CUBE510)
#define CTUI_CUBE511 CTUI_ANSI256(CTUIP_ANSI256_CUBE511)
#define CTUI_CUBE512 CTUI_ANSI256(CTUIP_ANSI256_CUBE512)
#define CTUI_CUBE513 CTUI_ANSI256(CTUIP_ANSI256_CUBE513)
#define CTUI_CUBE514 CTUI_ANSI256(CTUIP_ANSI256_CUBE514)
#define CTUI_CUBE515 CTUI_ANSI256(CTUIP_ANSI256_CUBE515)
#define CTUI_CUBE520 CTUI_ANSI256(CTUIP_ANSI256_CUBE520)
#define CTUI_CUBE521 CTUI_ANSI256(CTUIP_ANSI256_CUBE521)
#define CTUI_CUBE522 CTUI_ANSI256(CTUIP_ANSI256_CUBE522)
#define CTUI_CUBE523 CTUI_ANSI256(CTUIP_ANSI256_CUBE523)
#define CTUI_CUBE524 CTUI_ANSI256(CTUIP_ANSI256_CUBE524)
#define CTUI_CUBE525 CTUI_ANSI256(CTUIP_ANSI256_CUBE525)
#define CTUI_CUBE530 CTUI_ANSI256(CTUIP_ANSI256_CUBE530)
#define CTUI_CUBE531 CTUI_ANSI256(CTUIP_ANSI256_CUBE531)
#define CTUI_CUBE532 CTUI_ANSI256(CTUIP_ANSI256_CUBE532)
#define CTUI_CUBE533 CTUI_ANSI256(CTUIP_ANSI256_CUBE533)
#define CTUI_CUBE534 CTUI_ANSI256(CTUIP_ANSI256_CUBE534)
#define CTUI_CUBE535 CTUI_ANSI256(CTUIP_ANSI256_CUBE535)
#define CTUI_CUBE540 CTUI_ANSI256(CTUIP_ANSI256_CUBE540)
#define CTUI_CUBE541 CTUI_ANSI256(CTUIP_ANSI256_CUBE541)
#define CTUI_CUBE542 CTUI_ANSI256(CTUIP_ANSI256_CUBE542)
#define CTUI_CUBE543 CTUI_ANSI256(CTUIP_ANSI256_CUBE543)
#define CTUI_CUBE544 CTUI_ANSI256(CTUIP_ANSI256_CUBE544)
#define CTUI_CUBE545 CTUI_ANSI256(CTUIP_ANSI256_CUBE545)
#define CTUI_CUBE550 CTUI_ANSI256(CTUIP_ANSI256_CUBE550)
#define CTUI_CUBE551 CTUI_ANSI256(CTUIP_ANSI256_CUBE551)
#define CTUI_CUBE552 CTUI_ANSI256(CTUIP_ANSI256_CUBE552)
#define CTUI_CUBE553 CTUI_ANSI256(CTUIP_ANSI256_CUBE553)
#define CTUI_CUBE554 CTUI_ANSI256(CTUIP_ANSI256_CUBE554)
#define CTUI_CUBE555 CTUI_ANSI256(CTUIP_ANSI256_CUBE555)
#define CTUI_GRAY0 CTUI_ANSI256(CTUIP_ANSI256_GRAY0)
#define CTUI_GRAY1 CTUI_ANSI256(CTUIP_ANSI256_GRAY1)
#define CTUI_GRAY2 CTUI_ANSI256(CTUIP_ANSI256_GRAY2)
#define CTUI_GRAY3 CTUI_ANSI256(CTUIP_ANSI256_GRAY3)
#define CTUI_GRAY4 CTUI_ANSI256(CTUIP_ANSI256_GRAY4)
#define CTUI_GRAY5 CTUI_ANSI256(CTUIP_ANSI256_GRAY5)
#define CTUI_GRAY6 CTUI_ANSI256(CTUIP_ANSI256_GRAY6)
#define CTUI_GRAY7 CTUI_ANSI256(CTUIP_ANSI256_GRAY7)
#define CTUI_GRAY8 CTUI_ANSI256(CTUIP_ANSI256_GRAY8)
#define CTUI_GRAY9 CTUI_ANSI256(CTUIP_ANSI256_GRAY9)
#define CTUI_GRAY10 CTUI_ANSI256(CTUIP_ANSI256_GRAY10)
#define CTUI_GRAY11 CTUI_ANSI256(CTUIP_ANSI256_GRAY11)
#define CTUI_GRAY12 CTUI_ANSI256(CTUIP_ANSI256_GRAY12)
#define CTUI_GRAY13 CTUI_ANSI256(CTUIP_ANSI256_GRAY13)
#define CTUI_GRAY14 CTUI_ANSI256(CTUIP_ANSI256_GRAY14)
#define CTUI_GRAY15 CTUI_ANSI256(CTUIP_ANSI256_GRAY15)
#define CTUI_GRAY16 CTUI_ANSI256(CTUIP_ANSI256_GRAY16)
#define CTUI_GRAY17 CTUI_ANSI256(CTUIP_ANSI256_GRAY17)
#define CTUI_GRAY18 CTUI_ANSI256(CTUIP_ANSI256_GRAY18)
#define CTUI_GRAY19 CTUI_ANSI256(CTUIP_ANSI256_GRAY19)
#define CTUI_GRAY20 CTUI_ANSI256(CTUIP_ANSI256_GRAY20)
#define CTUI_GRAY21 CTUI_ANSI256(CTUIP_ANSI256_GRAY21)
#define CTUI_GRAY22 CTUI_ANSI256(CTUIP_ANSI256_GRAY22)
#define CTUI_GRAY23 CTUI_ANSI256(CTUIP_ANSI256_GRAY23)

extern const CTUI_ColorRgba32 CTUI_ANSI16_PALETTE[16];
extern const uint8_t CTUI_CUBE555_CHANNELS[6];
int CTUI_getColorDistanceSquared(uint8_t r1, uint8_t g1, uint8_t b1, uint8_t r2,
                                 uint8_t g2, uint8_t b2);
uint8_t CTUI_getNearestGrayChannel(CTUI_PaletteIndexAnsi256 ansi256);
uint8_t CTUI_getNearestAnsi256Cube555Channel(uint8_t channel);

CTUI_PaletteIndexAnsi8
CTUI_convertAnsi16ToAnsi8(CTUI_PaletteIndexAnsi16 ansi16);
CTUI_PaletteIndexAnsi8
CTUI_convertAnsi256ToAnsi8(CTUI_PaletteIndexAnsi256 ansi256);
CTUI_PaletteIndexAnsi8 CTUI_convertRgba32ToAnsi8(CTUI_ColorRgba32 rgba32);

CTUI_PaletteIndexAnsi16 CTUI_convertAnsi8ToAnsi16(CTUI_PaletteIndexAnsi8 ansi8);
CTUI_PaletteIndexAnsi16
CTUI_convertAnsi256ToAnsi16(CTUI_PaletteIndexAnsi256 ansi256);
CTUI_PaletteIndexAnsi16 CTUI_convertRgba32ToAnsi16(CTUI_ColorRgba32 rgba32);

CTUI_PaletteIndexAnsi256
CTUI_convertAnsi8ToAnsi256(CTUI_PaletteIndexAnsi8 ansi8);
CTUI_PaletteIndexAnsi256
CTUI_convertAnsi16ToAnsi256(CTUI_PaletteIndexAnsi16 ansi16);
CTUI_PaletteIndexAnsi256 CTUI_convertRgba32ToAnsi256(CTUI_ColorRgba32 rgba32);

CTUI_ColorRgba32 CTUI_convertAnsi8ToRgba32(CTUI_PaletteIndexAnsi8 ansi8);
CTUI_ColorRgba32 CTUI_convertAnsi16ToRgba32(CTUI_PaletteIndexAnsi16 ansi16);
CTUI_ColorRgba32 CTUI_convertAnsi256ToRgba32(CTUI_PaletteIndexAnsi256 ansi256);

CTUI_PaletteIndexAnsi8 CTUI_convertToAnsi8(CTUI_Color color);
CTUI_PaletteIndexAnsi16 CTUI_convertToAnsi16(CTUI_Color color);
CTUI_PaletteIndexAnsi256 CTUI_convertToAnsi256(CTUI_Color color);
CTUI_ColorRgba32 CTUI_convertToRgba32(CTUI_Color color);

typedef struct CTUI_IVector2 {
  int x;
  int y;
} CTUI_IVector2;

typedef struct CTUI_SVector2 {
  size_t x;
  size_t y;
} CTUI_SVector2;

typedef struct CTUI_FVector2 {
  float x;
  float y;
} CTUI_FVector2;

typedef struct CTUI_DVector2 {
  double x;
  double y;
} CTUI_DVector2;

typedef struct CTUI_Matrix4x4 {
  float m[16];
} CTUI_Matrix4x4;

typedef struct CTUI_Console CTUI_Console;
typedef struct CTUI_Font CTUI_Font;
typedef struct CTUI_Renderer CTUI_Renderer;

typedef struct CTUI_RendererVtable {
  int (*init)(CTUI_Renderer *renderer);
  void (*destroy)(CTUI_Renderer *renderer);
  void (*resize)(CTUI_Renderer *renderer, int width, int height);
  void (*render)(CTUI_Renderer *renderer, CTUI_Console *console);
  void *(*getOrCreateFontTexture)(CTUI_Renderer *renderer, CTUI_Font *font);
  void (*freeFontTexture)(CTUI_Renderer *renderer, void *texture_handle);
  void (*setTransform)(CTUI_Renderer *renderer, const float *matrix4x4);
  void (*makeCurrent)(CTUI_Renderer *renderer);
} CTUI_RendererVtable;

typedef struct CTUI_Renderer {
  const CTUI_RendererVtable *vtable;
  void *user_data;
} CTUI_Renderer;

int CTUI_rendererInit(CTUI_Renderer *r);
void CTUI_rendererDestroy(CTUI_Renderer *r);
void CTUI_rendererResize(CTUI_Renderer *r, int w, int h);
void CTUI_rendererRender(CTUI_Renderer *r, CTUI_Console *c);
void CTUI_rendererMakeCurrent(CTUI_Renderer *r);

typedef void (*CTUI_DestroyCallback)(CTUI_Console *console);
typedef void (*CTUI_ResizeCallback)(CTUI_Console *console,
                                    CTUI_SVector2 console_tile_wh);
typedef void (*CTUI_RefreshCallback)(CTUI_Console *console);
typedef void (*CTUI_PollEventsCallback)(CTUI_Console *console);
typedef CTUI_DVector2 (*CTUI_GetCursorViewportPosCallback)(
    CTUI_Console *console);
typedef CTUI_DVector2 (*CTUI_GetCursorTilePosCallback)(CTUI_Console *console);
typedef int (*CTUI_GetMouseButtonCallback)(CTUI_Console *console, int button);
typedef int (*CTUI_GetKeyStateCallback)(CTUI_Console *console, int key);
typedef void (*CTUI_TransformViewportCallback)(CTUI_Console *console,
                                               CTUI_FVector2 translation,
                                               CTUI_FVector2 scale);
typedef void (*CTUI_ResetViewportCallback)(CTUI_Console *console);
typedef void (*CTUI_SetWindowPixelWhCallback)(CTUI_Console *console,
                                              CTUI_IVector2 pixel_wh);
typedef CTUI_IVector2 (*CTUI_GetWindowPixelWhCallback)(CTUI_Console *console);
typedef void (*CTUI_SetViewportTileWhCallback)(CTUI_Console *console,
                                               CTUI_SVector2 tile_wh);
typedef void (*CTUI_FitWindowPixelWhToViewportTileWhCallback)(
    CTUI_Console *console);
typedef void (*CTUI_FitViewportTileWhToWindowPixelWhCallback)(
    CTUI_Console *console);
typedef void (*CTUI_SetWindowResizableCallback)(CTUI_Console *console,
                                                int resizable);
typedef int (*CTUI_GetWindowResizableCallback)(CTUI_Console *console);
typedef int (*CTUI_GetIsFullscreenCallback)(CTUI_Console *console);
typedef void (*CTUI_SetWindowDecoratedCallback)(CTUI_Console *console,
                                                int decorated);
typedef int (*CTUI_GetWindowDecoratedCallback)(CTUI_Console *console);
typedef void (*CTUI_SetWindowFloatingCallback)(CTUI_Console *console,
                                               int floating);
typedef int (*CTUI_GetWindowFloatingCallback)(CTUI_Console *console);
typedef void (*CTUI_MinimizeWindowCallback)(CTUI_Console *console);
typedef void (*CTUI_MaximizeWindowCallback)(CTUI_Console *console);
typedef void (*CTUI_RestoreWindowCallback)(CTUI_Console *console);
typedef int (*CTUI_GetWindowMinimizedCallback)(CTUI_Console *console);
typedef int (*CTUI_GetWindowMaximizedCallback)(CTUI_Console *console);
typedef void (*CTUI_FocusWindowCallback)(CTUI_Console *console);
typedef int (*CTUI_GetWindowFocusedCallback)(CTUI_Console *console);
typedef void (*CTUI_RequestWindowAttentionCallback)(CTUI_Console *console);
typedef void (*CTUI_SetWindowOpacityCallback)(CTUI_Console *console,
                                              float opacity);
typedef float (*CTUI_GetWindowOpacityCallback)(CTUI_Console *console);
typedef void (*CTUI_HideWindowCallback)(CTUI_Console *console);
typedef void (*CTUI_ShowWindowCallback)(CTUI_Console *console);
typedef void (*CTUI_SetWindowedTileWhCallback)(CTUI_Console *console,
                                               CTUI_SVector2 tile_wh);
typedef void (*CTUI_SetWindowedFullscreenCallback)(CTUI_Console *console);

typedef struct CTUI_ConsoleLayer CTUI_ConsoleLayer;
typedef void (*CTUI_PushCodepointCallback)(CTUI_ConsoleLayer *layer,
                                           uint32_t codepoint,
                                           CTUI_IVector2 pos_xy,
                                           CTUI_Color fg, CTUI_Color bg);
typedef void (*CTUI_FillCallback)(CTUI_ConsoleLayer *layer, uint32_t codepoint,
                                   CTUI_Color fg, CTUI_Color bg);

typedef struct CTUI_PlatformVtable {
  int is_resizable;
  CTUI_DestroyCallback destroy;
  CTUI_ResizeCallback resize;
  CTUI_RefreshCallback refresh;
  CTUI_PollEventsCallback pollEvents;
  CTUI_GetCursorViewportPosCallback getCursorViewportPos;
  CTUI_GetCursorTilePosCallback getCursorTilePos;
  CTUI_GetMouseButtonCallback getMouseButton;
  CTUI_GetKeyStateCallback getKeyState;
  CTUI_TransformViewportCallback transformViewport;
  CTUI_ResetViewportCallback resetViewport;
  CTUI_SetWindowPixelWhCallback setWindowPixelWh;
  CTUI_GetWindowPixelWhCallback getWindowPixelWh;
  CTUI_SetViewportTileWhCallback setViewportTileWh;
  CTUI_FitWindowPixelWhToViewportTileWhCallback
      fitWindowPixelWhToViewportTileWh;
  CTUI_FitViewportTileWhToWindowPixelWhCallback
      fitViewportTileWhToWindowPixelWh;
  CTUI_SetWindowResizableCallback setWindowResizable;
  CTUI_GetWindowResizableCallback getWindowResizable;
  CTUI_GetIsFullscreenCallback getIsFullscreen;
  CTUI_SetWindowDecoratedCallback setWindowDecorated;
  CTUI_GetWindowDecoratedCallback getWindowDecorated;
  CTUI_SetWindowFloatingCallback setWindowFloating;
  CTUI_GetWindowFloatingCallback getWindowFloating;
  CTUI_MinimizeWindowCallback minimizeWindow;
  CTUI_MaximizeWindowCallback maximizeWindow;
  CTUI_RestoreWindowCallback restoreWindow;
  CTUI_GetWindowMinimizedCallback getWindowMinimized;
  CTUI_GetWindowMaximizedCallback getWindowMaximized;
  CTUI_FocusWindowCallback focusWindow;
  CTUI_GetWindowFocusedCallback getWindowFocused;
  CTUI_RequestWindowAttentionCallback requestWindowAttention;
  CTUI_SetWindowOpacityCallback setWindowOpacity;
  CTUI_GetWindowOpacityCallback getWindowOpacity;
  CTUI_HideWindowCallback hideWindow;
  CTUI_ShowWindowCallback showWindow;
  CTUI_SetWindowedTileWhCallback setWindowedTileWh;
  CTUI_SetWindowedFullscreenCallback setWindowedFullscreen;
  // Layer operations - platform-specific tile handling
  size_t layer_size; // Size of platform-specific layer struct (0 = use default CTUI_ConsoleLayer)
  CTUI_PushCodepointCallback pushCodepoint;
  CTUI_FillCallback fill;
} CTUI_PlatformVtable;

typedef enum CTUI_Key {
  CTUIK_SPACE = 32,
  CTUIK_APOSTROPHE = 39,
  CTUIK_COMMA = 44,
  CTUIK_MINUS = 45,
  CTUIK_PERIOD = 46,
  CTUIK_SLASH = 47,
  CTUIK_NUM0 = 48,
  CTUIK_NUM1 = 49,
  CTUIK_NUM2 = 50,
  CTUIK_NUM3 = 51,
  CTUIK_NUM4 = 52,
  CTUIK_NUM5 = 53,
  CTUIK_NUM6 = 54,
  CTUIK_NUM7 = 55,
  CTUIK_NUM8 = 56,
  CTUIK_NUM9 = 57,
  CTUIK_SEMICOLON = 59,
  CTUIK_EQUAL = 61,
  CTUIK_A = 65,
  CTUIK_B = 66,
  CTUIK_C = 67,
  CTUIK_D = 68,
  CTUIK_E = 69,
  CTUIK_F = 70,
  CTUIK_G = 71,
  CTUIK_H = 72,
  CTUIK_I = 73,
  CTUIK_J = 74,
  CTUIK_K = 75,
  CTUIK_L = 76,
  CTUIK_M = 77,
  CTUIK_N = 78,
  CTUIK_O = 79,
  CTUIK_P = 80,
  CTUIK_Q = 81,
  CTUIK_R = 82,
  CTUIK_S = 83,
  CTUIK_T = 84,
  CTUIK_U = 85,
  CTUIK_V = 86,
  CTUIK_W = 87,
  CTUIK_X = 88,
  CTUIK_Y = 89,
  CTUIK_Z = 90,
  CTUIK_LEFT_BRACKET = 91,
  CTUIK_BACKSLASH = 92,
  CTUIK_RIGHT_BRACKET = 93,
  CTUIK_GRAVE_ACCENT = 96,
  CTUIK_WORLD_1 = 161,
  CTUIK_WORLD_2 = 162,
  CTUIK_ESCAPE = 256,
  CTUIK_ENTER = 257,
  CTUIK_TAB = 258,
  CTUIK_BACKSPACE = 259,
  CTUIK_INSERT = 260,
  CTUIK_DELETE = 261,
  CTUIK_RIGHT = 262,
  CTUIK_LEFT = 263,
  CTUIK_DOWN = 264,
  CTUIK_UP = 265,
  CTUIK_PAGE_UP = 266,
  CTUIK_PAGE_DOWN = 267,
  CTUIK_HOME = 268,
  CTUIK_END = 269,
  CTUIK_CAPS_LOCK = 280,
  CTUIK_SCROLL_LOCK = 281,
  CTUIK_NUM_LOCK = 282,
  CTUIK_PRINT_SCREEN = 283,
  CTUIK_PAUSE = 284,
  CTUIK_F1 = 290,
  CTUIK_F2 = 291,
  CTUIK_F3 = 292,
  CTUIK_F4 = 293,
  CTUIK_F5 = 294,
  CTUIK_F6 = 295,
  CTUIK_F7 = 296,
  CTUIK_F8 = 297,
  CTUIK_F9 = 298,
  CTUIK_F10 = 299,
  CTUIK_F11 = 300,
  CTUIK_F12 = 301,
  CTUIK_F13 = 302,
  CTUIK_F14 = 303,
  CTUIK_F15 = 304,
  CTUIK_F16 = 305,
  CTUIK_F17 = 306,
  CTUIK_F18 = 307,
  CTUIK_F19 = 308,
  CTUIK_F20 = 309,
  CTUIK_F21 = 310,
  CTUIK_F22 = 311,
  CTUIK_F23 = 312,
  CTUIK_F24 = 313,
  CTUIK_F25 = 314,
  CTUIK_KP_0 = 320,
  CTUIK_KP_1 = 321,
  CTUIK_KP_2 = 322,
  CTUIK_KP_3 = 323,
  CTUIK_KP_4 = 324,
  CTUIK_KP_5 = 325,
  CTUIK_KP_6 = 326,
  CTUIK_KP_7 = 327,
  CTUIK_KP_8 = 328,
  CTUIK_KP_9 = 329,
  CTUIK_KP_DECIMAL = 330,
  CTUIK_KP_DIVIDE = 331,
  CTUIK_KP_MULTIPLY = 332,
  CTUIK_KP_SUBTRACT = 333,
  CTUIK_KP_ADD = 334,
  CTUIK_KP_ENTER = 335,
  CTUIK_KP_EQUAL = 336,
  CTUIK_LEFT_SHIFT = 340,
  CTUIK_LEFT_CONTROL = 341,
  CTUIK_LEFT_ALT = 342,
  CTUIK_LEFT_SUPER = 343,
  CTUIK_RIGHT_SHIFT = 344,
  CTUIK_RIGHT_CONTROL = 345,
  CTUIK_RIGHT_ALT = 346,
  CTUIK_RIGHT_SUPER = 347,
  CTUIK_MENU = 348,
  CTUIK_LAST = CTUIK_MENU
} CTUI_Key;

typedef enum CTUI_MouseButton {
  CTUIMB_1 = 0,
  CTUIMB_2 = 1,
  CTUIMB_3 = 2,
  CTUIMB_4 = 3,
  CTUIMB_5 = 4,
  CTUIMB_6 = 5,
  CTUIMB_7 = 6,
  CTUIMB_8 = 7,
  CTUIMB_LAST = CTUIMB_8,
  CTUIMB_LEFT = CTUIMB_1,
  CTUIMB_RIGHT = CTUIMB_2,
  CTUIMB_MIDDLE = CTUIMB_3
} CTUI_MouseButton;

typedef enum CTUI_Action { CTUIA_RELEASE = 0, CTUIA_PRESS = 1 } CTUI_Action;

typedef enum CTUI_EventType {
  CTUI_EVENT_NONE = 0,
  CTUI_EVENT_KEY,
  CTUI_EVENT_MOUSE_BUTTON,
  CTUI_EVENT_CURSOR_POS,
  CTUI_EVENT_SCROLL,
  CTUI_EVENT_RESIZE,
  CTUI_EVENT_CLOSE
} CTUI_EventType;

typedef struct CTUI_Event {
  CTUI_EventType type;
  CTUI_Console *console;
  union {
    struct {
      CTUI_Key key;
      int scancode;
      CTUI_Action action;
      int mods;
    } key;
    struct {
      int button;
      int action;
      int mods;
    } mouse_button;
    struct {
      CTUI_DVector2 viewport_xy;
      CTUI_DVector2 tile_xy;
    } cursor_pos;
    struct {
      CTUI_DVector2 scroll_xy;
    } scroll;
    struct {
      CTUI_SVector2 console_tile_wh;
    } resize;
  } data;
} CTUI_Event;

typedef struct CTUI_Stpqp {
  // left x
  float s;
  // right x
  float t;
  // top y
  float p;
  // bottom y
  float q;
  // texture page
  float page;
} CTUI_Stpqp;

typedef struct CTUI_Glyph {
  // how many layer tiles wide and tall is this tile
  CTUI_SVector2 _tiles_wh;
  uint32_t _codepoint;
  CTUI_Stpqp _tex_coords;
} CTUI_Glyph;

typedef struct CTUI_Image {
  // pixels wide
  size_t _width;
  // pixels tall
  size_t _height;
  // texture page count
  size_t _pages;
  // pixels data array (8 bit channel RGBA)
  unsigned char *_pixels;
} CTUI_Image;

typedef struct CTUI_Context CTUI_Context;
typedef struct CTUI_Font CTUI_Font;

typedef struct CTUI_Font {
  CTUI_Image _image;
  size_t _max_map_offset;
  size_t _map_size;
  CTUI_Glyph *_glyph_map;
} CTUI_Font;

typedef struct CTUI_ConsoleTile {
  CTUI_SVector2 _pos_xy;
  uint32_t _codepoint;
  CTUI_Color _fg;
  CTUI_Color _bg;
} CTUI_ConsoleTile;

typedef struct CTUI_ConsoleLayer {
  CTUI_Console *_console;
  CTUI_DVector2 _tile_div_wh;
  CTUI_Font *_font;
} CTUI_ConsoleLayer;

typedef struct CTUI_LayerInfo {
  CTUI_Font *font;
  CTUI_DVector2 tile_div_wh;
} CTUI_LayerInfo;

typedef struct CTUI_Context {
  CTUI_Console *_first_console;
  CTUI_Font *_first_font;
  CTUI_Event *_event_queue;
  size_t _event_queue_capacity;
  size_t _event_queue_count;
  size_t _event_queue_head;
  uint64_t _target_frame_ns;
  uint64_t _last_frame_ns;
} CTUI_Context;

typedef struct CTUI_Console {
  CTUI_PlatformVtable *_platform;
  CTUI_Context *_ctx;
  int _is_real_terminal;
  CTUI_Console *_next;
  CTUI_Console *_prev;
  CTUI_SVector2 _console_tile_wh;
  size_t _layer_count;
  size_t _layer_size;
  void *_layers;
  CTUI_Color _fill_bg_color;
  int _fill_bg_set;
  CTUI_ColorMode _effective_color_mode;
} CTUI_Console;

int CTUI_getHasRealTerminal();

CTUI_Context *CTUI_createContext();

void CTUI_destroyContext(CTUI_Context *ctx);

void CTUI_setTargetFrameNs(CTUI_Context *ctx, uint64_t target_frame_ns);

uint64_t CTUI_getTargetFrameNs(CTUI_Context *ctx);

int CTUI_hasConsole(CTUI_Context *ctx);

void CTUI_pollEvents(CTUI_Context *ctx);

void CTUI_pushEvent(CTUI_Context *ctx, CTUI_Event *event);

int CTUI_nextEvent(CTUI_Context *ctx, CTUI_Event *event);

CTUI_Font *CTUI_createFont(const char *ctuifont_path, const char **image_paths,
                           size_t image_count);

void CTUI_destroyFont(CTUI_Font *font);

CTUI_Glyph *CTUI_tryGetGlyph(CTUI_Font *font, uint32_t codepoint);

CTUI_SVector2 CTUI_getGlyphTilesWh(const CTUI_Glyph *glyph);

uint32_t CTUI_getGlyphCodepoint(const CTUI_Glyph *glyph);

CTUI_Stpqp CTUI_getGlyphTexCoords(const CTUI_Glyph *glyph);

size_t CTUI_getFontImageWidth(const CTUI_Font *font);

size_t CTUI_getFontImageHeight(const CTUI_Font *font);

size_t CTUI_getFontImagePages(const CTUI_Font *font);

CTUI_DVector2 CTUI_getLayerTileDivWh(const CTUI_ConsoleLayer *layer);

void CTUI_setLayerTileDivWh(CTUI_Console *console, size_t layer_i,
                            CTUI_DVector2 tile_div_wh);

const CTUI_Font *CTUI_getFont(const CTUI_ConsoleLayer *layer);

void CTUI_setFont(CTUI_ConsoleLayer *layer, CTUI_Font *font);

CTUI_SVector2 CTUI_getConsoleTileWh(const CTUI_Console *console);

size_t CTUI_getConsoleLayerCount(const CTUI_Console *console);

CTUI_ConsoleLayer *CTUI_getConsoleLayer(CTUI_Console *console, size_t layer_i);

CTUI_ColorMode CTUI_getConsoleColorMode(const CTUI_Console *console);

int CTUI_getConsoleIsRealTerminal(const CTUI_Console *console);

void CTUI_destroyConsole(CTUI_Console *console);

int CTUI_getIsWindow(CTUI_Console *console);

void CTUI_hideWindow(CTUI_Console *console);

void CTUI_showWindow(CTUI_Console *console);

void CTUI_setWindowedTileWh(CTUI_Console *console,
                            CTUI_SVector2 console_tile_wh);

void CTUI_setWindowedFullscreen(CTUI_Console *console);

int CTUI_getIsFullscreen(CTUI_Console *console);

void CTUI_setWindowPixelWh(CTUI_Console *console, CTUI_IVector2 pixel_wh);

CTUI_IVector2 CTUI_getWindowPixelWh(CTUI_Console *console);

void CTUI_setViewportTileWh(CTUI_Console *console, CTUI_SVector2 tile_wh);

void CTUI_fitWindowPixelWhToViewportTileWh(CTUI_Console *console);

void CTUI_fitViewportTileWhToWindowPixelWh(CTUI_Console *console);

void CTUI_setWindowResizable(CTUI_Console *console, int resizable);

int CTUI_getWindowResizable(CTUI_Console *console);

void CTUI_setWindowDecorated(CTUI_Console *console, int decorated);

int CTUI_getWindowDecorated(CTUI_Console *console);

void CTUI_setWindowFloating(CTUI_Console *console, int floating);

int CTUI_getWindowFloating(CTUI_Console *console);

void CTUI_minimizeWindow(CTUI_Console *console);

void CTUI_maximizeWindow(CTUI_Console *console);

void CTUI_restoreWindow(CTUI_Console *console);

int CTUI_getWindowMinimized(CTUI_Console *console);

int CTUI_getWindowMaximized(CTUI_Console *console);

void CTUI_focusWindow(CTUI_Console *console);

int CTUI_getWindowFocused(CTUI_Console *console);

void CTUI_requestWindowAttention(CTUI_Console *console);

void CTUI_setWindowOpacity(CTUI_Console *console, float opacity);

float CTUI_getWindowOpacity(CTUI_Console *console);

int CTUI_getHasViewport(CTUI_Console *console);

void CTUI_transformViewport(CTUI_Console *console, CTUI_FVector2 translation,
                            CTUI_FVector2 scale);

void CTUI_resetViewport(CTUI_Console *console);

CTUI_DVector2 CTUI_getCursorViewportPos(CTUI_Console *console);

CTUI_DVector2 CTUI_getCursorTilePos(CTUI_Console *console);

int CTUI_getMouseButton(CTUI_Console *console, CTUI_MouseButton button);

int CTUI_getKeyState(CTUI_Console *console, CTUI_Key key);

void CTUI_pushCodepoint(CTUI_ConsoleLayer *layer, uint32_t codepoint,
                        CTUI_IVector2 pos_xy, CTUI_Color fg, CTUI_Color bg);

uint32_t CTUI_decodeUtf8Cstr(const char **str);

void CTUI_pushCstr(CTUI_ConsoleLayer *layer, const char *text,
                     CTUI_IVector2 pos_xy, size_t wrap_width, size_t max_height,
                     CTUI_Color fg, CTUI_Color bg);

void CTUI_fill(CTUI_ConsoleLayer *layer, uint32_t codepoint, CTUI_Color fg,
               CTUI_Color bg);

void CTUI_refresh(CTUI_Context* ctx);

typedef void *(*CTUI_GLGetProcAddress)(const char *name);

CTUI_Renderer *
CTUI_createOpenGL33Renderer(CTUI_GLGetProcAddress getProcAddress);

void CTUI_destroyOpenGL33Renderer(CTUI_Renderer *renderer);

CTUI_Console *CTUI_createGlfwOpengl33FakeTerminal(
    CTUI_Context *context, CTUI_DVector2 tile_pixel_wh, size_t layer_count,
    const CTUI_LayerInfo *layer_infos, CTUI_ColorMode color_mode,
    const char *title);

CTUI_Console *CTUI_createNcursesRealTerminal(CTUI_Context *ctx, int layer_count,
                                             enum CTUI_ColorMode color_mode);

#ifdef __cplusplus
}
#endif

#endif